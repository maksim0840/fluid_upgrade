# fluid_upgrade

# Упрощённая компиляция и запуск

- fluid_upgrade - директория проекта.
- Компиляция долгая ~ 2 мин.
```
cd fluid_upgrade
mkdir build
cd build
cmake ..
cmake --build .
./fluid
```

# Запуск с параметрами

1) Всегда стабильно работает
```
cmake -DTYPES="(FIXED(32,16))" .
cmake --build .
./fluid --p-type="FIXED(32, 16)" --v-type="FIXED(32, 16)" --v-flow-type="FIXED(32, 16)"
```

2) То же самое что и в упрощённом запуске, но с точным указанием параметров.
```
cmake -DTYPES="(DOUBLE)" .
cmake --build .
./fluid --p-type="DOUBLE" --v-type="DOUBLE" --v-flow-type="DOUBLE"
```

*Другие параметры не запустятся из-за наложенных ограничений в программе для достижения допустимого времени компиляции

------------------
# Информация о возможных параметрах компиляция
------------------

```
cmake -DTYPES="(FAST_FIXED(32,5), FIXED(32,16), DOUBLE)" .
```

- По умолчанию не указанный тип, считается за DOUBLE.

- Время компиляции зависит от количества передаваемых параметров в -DTYPES и количества раскоментированных блоков макроса из файла macro_params.


------------------
# Информация о возможных параметрах запуска
------------------


```
./fluid --p-type="FAST_FIXED(32, 5)" --v-type="FIXED(32, 16)" --v-flow-type="DOUBLE"
```

- --p-type - тип для p (по умолчанию DOUBLE)
- --v-type - тип для velocity (по умолчанию DOUBLE)
- --v-flow-type - ип для velocity_flow (по умолчанию DOUBLE)
- --save-tick - сохраняет каждый n-ый тик (если текущий номер тика кратен save_tick) (очищает предыдущие сохранения)
- --load-tick - минимальный номер тика, с которого начнёт эмулятор (программа начнёт с минимального тика, который >= load_tick) (по умолчанию 0)




------------------
# Проверка сохранения тиков
------------------

Компиляция с параметром FIXED(32,16) (если не скомпилировано ранее):
```
cmake -DTYPES="(FIXED(32, 16))" .
```

Сохранение каждого 10 тика в файл
```
./fluid --p-type="FIXED(32, 16)" --v-type="FIXED(32, 16)" --v-flow-type="FIXED(32, 16)" --save-tick=10
```

Стартовать с 50 тика
```
./fluid --p-type="FIXED(32, 16)" --v-type="FIXED(32, 16)" --v-flow-type="FIXED(32, 16)" --load-tick=50
```


------------------
# Структура файлов

- types - папка с реализацией шаблонных типов
    - base.hpp - файл, содержащий базовые объявления, требуемые во всех реализуемых типах
    - fixed.hpp - реализация типа Fixed(N, K)
    - fast_fixed.hpp - реализация типа FastFixed(N, K)
    - float.hpp - реализация типа Float(N, 0) ~ обёртка double и float для передачи и использования в эмуляторе
    - fixed_operations.hpp - общие операции над типами
- emulator - папка с реализацией эмулятора жидкости и сохранения тиков
- start_values - чтение начальных значений для эмулятора из файла
- params - чтение параметров при компиляции и при запуске программы

-macro_params.hpp - макрос, нужный для передачи типов и их размеров в эмулятор
-fluid.cpp - запускает программу