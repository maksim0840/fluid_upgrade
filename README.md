# fluid_upgrade
-------------------
# Упрощённая компиляция и запуск без параметров
- тестил, компилировал на g++13 под linux (в CMakeLists можно раскоментировать строчку с компилятором, чтобы быть в тех же условиях)
- fluid_upgrade - директория проекта.
- По умолчанию, если нигде не указывать параметры, будет тип double (double может подзависнуть на каком-то тике а потом через время снова продолжить)

```
cd fluid_upgrade
mkdir build
cd build
cmake ..
cmake --build .
./fluid
```

-------------------
# Компиляция и запуск с параметрами (проверенные - точно должны работать)

1) C одним параметром
```
cmake -DTYPES="(FIXED(32,16))" .
cmake --build .
./fluid --p-type="FIXED(32,16)" --v-type="FIXED(32,16)" --v-flow-type="FIXED(32,16)"
```

2) С двумя параметрами.
```
cmake -DTYPES="(FAST_FIXED(32,16), DOUBLE)" .
cmake --build .
./fluid --p-type="FAST_FIXED(32,16)" --v-type="FAST_FIXED(32,16)" --v-flow-type="DOUBLE"
```
3) С тремя параметрами
```
cmake -DTYPES="(FIXED(32,16), FAST_FIXED(32,16), DOUBLE)" .
cmake --build .
./fluid --p-type="FAST_FIXED(32,16)" --v-type="FIXED(32,16)" --v-flow-type="DOUBLE"
```

- Можно корректировать размеры внутри типов.
- Если выдаёт ошибку иногда помогает полная пересборка с удалением папки build
------------------
# Информация о возможных параметрах компиляция

```
cmake -DTYPES="(FAST_FIXED(32,16), FIXED(32,16), DOUBLE)" .
```

- По умолчанию не указанный DTYPES считается за DOUBLE.

- Время компиляции зависит от количества передаваемых параметров в -DTYPES и версии компилятора

- Компиляция требуется только при первом запуске программы или смене типов DTYPES

- Компилировал на g++13 - всё было достаточно быстро (точно не более 1-2 минут) и без ошибок

- Компилировал на g++11 - всё было очень долго (компиляция больше 15 минут)

- Парсинг параметров: ", "-разделение двух типов, ","-разделение размеров типов, не указывать лишние пробелы, указывать внешние скобки и внешние кавычки, указывать правильные названия типов (FAST_FIXED)

------------------
# Информация о возможных параметрах запуска


```
./fluid --p-type="FAST_FIXED(32,16)" --v-type="FIXED(32,16)" --v-flow-type="DOUBLE"
```

- --p-type - тип для p (по умолчанию DOUBLE)
- --v-type - тип для velocity (по умолчанию DOUBLE)
- --v-flow-type - ип для velocity_flow (по умолчанию DOUBLE)
- --save-tick - сохраняет каждый n-ый тик (если текущий номер тика кратен save_tick) (очищает предыдущие сохранения)
- --load-tick - минимальный номер тика, с которого начнёт эмулятор (программа начнёт с минимального тика, который >= load_tick)




------------------
# Проверка сохранения тиков


В примере показана компиляция с параметром FIXED(32,16):
```
cmake -DTYPES="(FIXED(32,16))" .
cmake --build .
```

Сохранение каждого 10 тика в файл
```
./fluid --p-type="FIXED(32,16)" --v-type="FIXED(32,16)" --v-flow-type="FIXED(32,16)" --save-tick=10
```

Стартовать с 50 тика
```
./fluid --p-type="FIXED(32,16)" --v-type="FIXED(32,16)" --v-flow-type="FIXED(32,16)" --load-tick=50
```
- если указан слишком большой load-tick (который не был сохраненён), то эмуляция просто начнется с 0 тика
- если указан load-tick который не сохранён, но после этого значения ещё есть тики, то эмуляция начнётся с ближийшего большего тика
------------------
# Структура файлов

- types - папка с реализацией шаблонных типов
    - base.hpp - файл, содержащий базовые объявления, требуемые во всех реализуемых типах
    - fixed.hpp - реализация типа Fixed(N, K)
    - fast_fixed.hpp - реализация типа FastFixed(N, K)
    - float.hpp - реализация типа Float(N, 0) ~ обёртка double и float для передачи и использования в эмуляторе
    - fixed_operations.hpp - общие операции над типами
- emulator - папка с реализацией эмулятора жидкости и сохранения тиков
- start_values - чтение начальных значений для эмулятора из файла
- params - чтение параметров при компиляции и при запуске программы

- macro_params.hpp - макрос, нужный для передачи типов и их размеров в эмулятор
- fluid.cpp - запускает программу
